---
import "../styles/global.css";
const DEFAULT_THEME = "cupcake";
const DARK_THEME = "dark";
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro Basics</title>

		{
			import.meta.env.PROD && (
				<>
					<!-- Google tag (gtag.js) -->
					<script
						is:inline
						async
						src="https://www.googletagmanager.com/gtag/js?id=G-V5C1Z2ZXD9"
					></script>
					<script is:inline>
						window.dataLayer = window.dataLayer || [];
						function gtag(){dataLayer.push(arguments);}
						gtag('js', new Date());
						
						gtag('config', 'G-V5C1Z2ZXD9');
					</script>
				</>	
			)
		}
	</head>
	<body>
		<slot />

		<!-- Mobile Theme Controller (Fixed Bottom Right) -->
		<div class="toast toast-end z-50">
			<label
				class="swap swap-rotate btn btn-circle btn-primary shadow-lg"
			>
				<!-- this hidden checkbox controls the state -->
				<input
					type="checkbox"
					class="theme-controller"
					value={DARK_THEME}
				/>

				<!-- sun icon -->
				<svg
					class="swap-off h-7 w-7 fill-current"
					xmlns="http://www.w3.org/2000/svg"
					viewBox="0 0 24 24"
				>
					<path
						d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.71.71l.71-.71a1,1,0,0,0,0-1.41,1,1,0,0,0-1.41,0l-.71.71A1,1,0,0,0,5.64,7.05Zm13.01,7.38a1,1,0,0,0,.71.71l.71-.71a1,1,0,0,0,0-1.41,1,1,0,0,0-1.41,0l-.71.71A1,1,0,0,0,18.65,14.43Zm-7,7a1,1,0,0,0,1-1V20a1,1,0,0,0-2,0v1A1,1,0,0,0,12,21.43Zm7-14.43-.71-.71a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.41l.71.71a1,1,0,0,0,1.41,0A1,1,0,0,0,19.35,7ZM20.35,11a1,1,0,0,0-1,1h1a1,1,0,0,0,0-2h-1A1,1,0,0,0,20.35,11ZM12,6A6,6,0,1,0,18,12,6.01,6.01,0,0,0,12,6Z"
					></path>
				</svg>

				<!-- moon icon -->
				<svg
					class="swap-on h-7 w-7 fill-current"
					xmlns="http://www.w3.org/2000/svg"
					viewBox="0 0 24 24"
				>
					<path
						d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Z"
					></path>
				</svg>
			</label>
		</div>
	</body>
</html>

<script is:inline>
	// ☝️ This script prevents the FART effect.
	const theme = localStorage.getItem("theme");
	if (theme === null) {
		document.documentElement.setAttribute("data-theme", DEFAULT_THEME);
	} else {
		document.documentElement.setAttribute("data-theme", theme);
	}

	function initTheme() {
		const themeController = document.querySelector(".theme-controller");
		if (!themeController) return;

		// Set initial state based on current theme
		const currentTheme =
			localStorage.getItem("theme") ||
			document.documentElement.getAttribute("data-theme") ||
			DEFAULT_THEME;

		if (currentTheme === DARK_THEME) {
			themeController.checked = true;
		}

		themeController.addEventListener("change", (e) => {
			const isDark = e.target.checked;
			const newTheme = isDark ? DARK_THEME : DEFAULT_THEME;

			localStorage.setItem("theme", newTheme);
			document.documentElement.setAttribute("data-theme", newTheme);
		});
	}

	// Initialize on page load (Astro View Transitions compatible)
	document.addEventListener("DOMContentLoaded", initTheme);
	document.addEventListener("astro:page-load", initTheme);
	// Also run immediately in case we're not using view transitions or DOMContentLoaded is already fired
	initTheme();
</script>
<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
