---
import { Code } from "astro:components";
---

<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-12">
        <h1
            class="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-linear-to-r from-primary to-secondary"
        >
            Random NanoID Generator
        </h1>
        <p class="text-base-content/70">
            Generate tiny, secure, URL-friendly, unique string IDs.
        </p>
    </div>

    <!-- Configuration Card -->
    <div class="card bg-base-100 shadow-xl mb-8 border border-base-300">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Configuration</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-control">
                    <label class="label" for="nanoidLength">
                        <span class="label-text">Length (2-36)</span>
                    </label>
                    <input
                        type="number"
                        id="nanoidLength"
                        class="input input-bordered w-full"
                        value="21"
                        min="2"
                        max="36"
                    />
                </div>
                <div class="form-control">
                    <label class="label" for="nanoidAlphabet">
                        <span class="label-text">Custom Alphabet</span>
                        <button
                            id="resetAlphabetBtn"
                            class="btn btn-xs btn-ghost text-primary"
                        >
                            Reset Default
                        </button>
                    </label>
                    <input
                        type="text"
                        id="nanoidAlphabet"
                        class="input input-bordered w-full font-mono text-sm"
                        value="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-"
                    />
                </div>
            </div>
        </div>
    </div>

    <!-- Single NanoID Generator Card -->
    <div class="card bg-base-100 shadow-xl mb-8 border border-base-300">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-6">Single NanoID</h2>

            <div
                class="flex flex-col md:flex-row gap-4 items-center justify-between p-6 bg-base-200 rounded-box mb-6"
            >
                <code
                    id="singleNanoid"
                    class="text-xl md:text-2xl font-mono break-all text-primary font-bold"
                >
                    Click generate to start
                </code>
                <div class="flex gap-2 shrink-0">
                    <button
                        id="copySingleBtn"
                        class="btn btn-square btn-ghost"
                        aria-label="Copy NanoID"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                            ></path>
                        </svg>
                    </button>
                    <button
                        id="regenerateBtn"
                        class="btn btn-square btn-ghost"
                        aria-label="Regenerate NanoID"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                            ></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="flex justify-end">
                <button
                    id="generateBtn"
                    class="btn btn-primary w-full sm:w-auto min-w-[200px]"
                >
                    Generate
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk NanoID Generator Card -->
    <div class="card bg-base-100 shadow-xl border border-base-300">
        <div class="card-body">
            <div class="flex justify-between items-center mb-6">
                <h2 class="card-title text-2xl">Bulk Generation</h2>
                <span class="badge badge-secondary">Batch Mode</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 mb-6 gap-4">
                <div class="form-control">
                    <input
                        type="number"
                        id="bulkCount"
                        class="input input-bordered"
                        value="10"
                        min="1"
                        max="100"
                    />
                    <label class="label" for="bulkCount">
                        <span class="label-text">Quantity (1-100)</span>
                    </label>
                </div>
                <div class="form-control justify-end">
                    <button
                        id="generateBulkBtn"
                        class="btn btn-primary w-full min-w-[200px]"
                    >
                        Generate
                    </button>
                </div>
            </div>

            <div class="relative">
                <div
                    id="bulkOutput"
                    class="textarea textarea-bordered h-64 w-full font-mono text-sm leading-relaxed overflow-y-auto bg-base-200 p-4 rounded-box empty:before:content-['Generated_NanoIDs_will_appear_here...'] empty:before:text-base-content/50 empty:before:italic"
                >
                </div>
                <div class="absolute top-2 right-2 flex gap-2">
                    <button
                        id="copyBulkBtn"
                        class="btn btn-xs btn-ghost tooltip tooltip-left"
                        data-tip="Copy All"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                            ></path>
                        </svg>
                    </button>
                    <button
                        id="downloadBulkBtn"
                        class="btn btn-xs btn-ghost tooltip tooltip-left"
                        data-tip="Download .txt"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                            ></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div
                class="text-xs text-base-content/50 mt-2 text-right"
                id="nanoidCounter"
            >
            </div>
        </div>
    </div>

    <!-- SEO Content -->
    <div class="card bg-base-100 shadow-xl border border-base-300 mt-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">About NanoID Generator</h2>
            <div class="prose max-w-none">
                <p>
                    If your priority is <strong>short IDs</strong> that are easy to
                    paste into URLs and logs but still offer strong collision resistance,
                    <strong>NanoID</strong> is a great fit. NanoID is designed for
                    JavaScript and produces <strong>URL-friendly IDs</strong> using
                    a safe alphabet like <code>A-Za-z0-9_-</code>, which packs
                    lots of randomness into fewer characters.
                </p>

                <h3 class="text-lg font-bold mt-4 mb-2">
                    Why NanoID is popular
                </h3>
                <ul class="list-disc pl-5 mb-4">
                    <li>
                        <strong>Short by default:</strong> NanoID’s default length
                        is <strong>21 characters</strong>, chosen to reach
                        collision resistance comparable to UUID v4 while being
                        much shorter.
                    </li>
                    <li>
                        <strong>Strong randomness:</strong> It uses Node’s <code
                            >crypto</code
                        > and the browser <strong>Web Crypto API</strong>,
                        avoiding <code>Math.random()</code> for secure usage.
                    </li>
                    <li>
                        <strong>Customizable:</strong> You can tune <strong
                            >length</strong
                        >, and even define a <strong>custom alphabet</strong> to match
                        your product’s constraints (e.g., lowercase-only slugs, hex
                        IDs, no ambiguous characters).
                    </li>
                </ul>

                <h3 class="text-lg font-bold mt-6 mb-2">
                    JavaScript / TypeScript examples
                </h3>

                <p class="mb-2"><strong>Basic usage:</strong></p>
                <Code
                    code={`import { nanoid } from "nanoid";

const id: string = nanoid();      // e.g. "V1StGXR8_Z5jdHi6B-myT"
const short: string = nanoid(10); // shorter => higher collision risk

console.log({ id, short });`}
                    lang="ts"
                    theme="dark-plus"
                />

                <p class="mb-2">
                    <strong
                        >Custom alphabet + size (great for “slug IDs”):</strong>
                </p>
                <Code
                    code={`import { customAlphabet } from "nanoid";

// hex-ish IDs, 10 chars
const makeHexId = customAlphabet("1234567890abcdef", 10);

const orderId: string = makeHexId(); // e.g. "4f90d13a42"
console.log(orderId);`}
                    lang="ts"
                    theme="dark-plus"
                />

                <h3 class="text-lg font-bold mt-4 mb-2">
                    When NanoID is the best choice
                </h3>
                <ul class="list-disc pl-5 mb-4">
                    <li>
                        <strong>Public URLs</strong> (invite links, short resources,
                        share links)
                    </li>
                    <li>
                        <strong>Client-generated IDs</strong> (optimistic UI, offline
                        drafts)
                    </li>
                    <li>
                        <strong>Distributed systems</strong> where shortness matters
                        (logs, analytics events)
                    </li>
                </ul>

                <hr class="my-6 border-base-200" />

                <p class="text-sm text-base-content/70">
                    Need a compact <strong>random number generator</strong> or <strong
                        >random generator</strong
                    > for URLs? This <strong>NanoID</strong> tool serves as a configurable
                    <strong>random object generator</strong>, creating URL-safe,
                    unique strings. It beats a generic <strong
                        >google random number generator</strong
                    >
                    or <strong>random nr</strong> tool by offering cryptographically
                    strong, collision-resistant identifiers customizable to your needs.
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div
        id="toast"
        class="toast toast-bottom toast-center transition-opacity duration-300 opacity-0 pointer-events-none"
    >
        <div class="alert alert-info">
            <span id="toastMessage">Message sent successfully.</span>
        </div>
    </div>
</div>

<script>
    import { customAlphabet } from "nanoid";

    // Constants
    const DEFAULT_ALPHABET =
        "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-";

    // DOM Elements
    const singleNanoidEl = document.getElementById("singleNanoid");
    const generateBtn = document.getElementById("generateBtn");
    const regenerateBtn = document.getElementById("regenerateBtn");
    const copySingleBtn = document.getElementById("copySingleBtn");

    // Config Elements
    const nanoidLengthInput = document.getElementById(
        "nanoidLength",
    ) as HTMLInputElement;
    const nanoidAlphabetInput = document.getElementById(
        "nanoidAlphabet",
    ) as HTMLInputElement;
    const resetAlphabetBtn = document.getElementById("resetAlphabetBtn");

    const bulkCountInput = document.getElementById(
        "bulkCount",
    ) as HTMLInputElement;
    const generateBulkBtn = document.getElementById("generateBulkBtn");
    const bulkOutput = document.getElementById("bulkOutput");
    const copyBulkBtn = document.getElementById("copyBulkBtn");
    const downloadBulkBtn = document.getElementById("downloadBulkBtn");
    const nanoidCounter = document.getElementById("nanoidCounter");

    let bulkNanoids: string[] = [];

    function getNanoIdGenerator() {
        const length = Math.min(
            Math.max(parseInt(nanoidLengthInput?.value || "21"), 2),
            36,
        );
        const alphabet = nanoidAlphabetInput?.value || DEFAULT_ALPHABET;

        const nanoid = customAlphabet(alphabet, length);
        return nanoid;
    }

    // Single NanoID Logic
    function updateSingleNanoID() {
        if (!singleNanoidEl) return;

        const nanoid = getNanoIdGenerator();

        singleNanoidEl.classList.add("opacity-50");
        setTimeout(() => {
            singleNanoidEl.textContent = nanoid();
            singleNanoidEl.classList.remove("opacity-50");
        }, 150);
    }

    resetAlphabetBtn?.addEventListener("click", () => {
        if (nanoidAlphabetInput) {
            nanoidAlphabetInput.value = DEFAULT_ALPHABET;
        }
    });

    generateBtn?.addEventListener("click", updateSingleNanoID);
    regenerateBtn?.addEventListener("click", updateSingleNanoID);

    copySingleBtn?.addEventListener("click", () => {
        const text = singleNanoidEl?.textContent?.trim();
        if (text && text !== "Click generate to start") {
            copyToClipboard(text);
            showToast("NanoID copied to clipboard!");
        } else {
            updateSingleNanoID();
            setTimeout(() => {
                const newText = singleNanoidEl?.textContent?.trim();
                if (newText) {
                    copyToClipboard(newText);
                    showToast("Generated & Copied!");
                }
            }, 200);
        }
    });

    // Bulk NanoID Logic
    function generateBulk() {
        if (!bulkCountInput || !bulkOutput || !nanoidCounter) return;

        let count = Math.min(
            Math.max(parseInt(bulkCountInput.value) || 10, 1),
            100,
        );
        bulkCountInput.value = count.toString();

        const nanoid = getNanoIdGenerator();

        bulkNanoids = [];
        for (let i = 0; i < count; i++) {
            bulkNanoids.push(nanoid());
        }

        bulkOutput.innerHTML = bulkNanoids.join("<br>");
        nanoidCounter.textContent = `Generated ${bulkNanoids.length} NanoID${bulkNanoids.length > 1 ? "s" : ""}`;
    }

    generateBulkBtn?.addEventListener("click", generateBulk);

    copyBulkBtn?.addEventListener("click", () => {
        if (bulkNanoids.length > 0) {
            copyToClipboard(bulkNanoids.join("\n"));
            showToast(`${bulkNanoids.length} NanoIDs copied to clipboard!`);
        } else {
            showToast("Generate NanoIDs first!");
        }
    });

    downloadBulkBtn?.addEventListener("click", () => {
        if (bulkNanoids.length > 0) {
            const blob = new Blob([bulkNanoids.join("\n")], {
                type: "text/plain",
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `nanoids-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast("NanoIDs downloaded!");
        } else {
            showToast("Generate NanoIDs first!");
        }
    });

    // Utilities
    function copyToClipboard(text: string) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text);
        } else {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            textarea.style.opacity = "0";
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
        }
    }

    function showToast(message: string) {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");
        if (toast && toastMessage) {
            toastMessage.textContent = message;
            toast.classList.remove("opacity-0");
            setTimeout(() => toast.classList.add("opacity-0"), 2500);
        }
    }

    // Validation for inputs
    nanoidLengthInput?.addEventListener(
        "input",
        function (this: HTMLInputElement) {
            let value = parseInt(this.value);
            if (value > 36) this.value = "36";
            if (value < 2 && this.value !== "") {
                // Allow empty or low values during typing, caught on blur or generation
            }
        },
    );

    nanoidLengthInput?.addEventListener(
        "blur",
        function (this: HTMLInputElement) {
            let value = parseInt(this.value);
            if (isNaN(value) || value < 2) this.value = "2";
        },
    );

    bulkCountInput?.addEventListener(
        "input",
        function (this: HTMLInputElement) {
            let value = parseInt(this.value);
            if (value > 100) this.value = "100";
            if (value < 1 && this.value !== "") this.value = "1";
        },
    );

    // Initial load
    updateSingleNanoID();
</script>
