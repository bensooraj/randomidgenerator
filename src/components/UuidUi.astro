---
import { Code } from "astro:components";
---

<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1
            class="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-linear-to-r from-primary to-secondary"
        >
            Random UUID Generator
        </h1>
        <p class="text-base-content/70">
            Generate standard UUIDs (v4, v5, v6, v7). Free, fast, and secure.
        </p>
    </div>

    <!-- Global Configuration -->
    <div class="card bg-base-100 shadow-xl mb-8 border border-base-300">
        <div class="card-body">
            <h2 class="card-title text-xl mb-4">Configuration</h2>
            <div class="flex flex-col gap-6">
                <!-- Version Selection -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-bold">UUID Version</span>
                    </label>
                    <div class="flex flex-wrap gap-4">
                        <label
                            class="label cursor-pointer gap-2 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors"
                        >
                            <input
                                type="radio"
                                name="uuidVersion"
                                value="v4"
                                class="radio radio-primary radio-sm"
                                checked
                            />
                            <span class="label-text">v4 (Random)</span>
                        </label>
                        <label
                            class="label cursor-pointer gap-2 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors"
                        >
                            <input
                                type="radio"
                                name="uuidVersion"
                                value="v6"
                                class="radio radio-primary radio-sm"
                            />
                            <span class="label-text">v6 (Time-ordered)</span>
                        </label>
                        <label
                            class="label cursor-pointer gap-2 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors"
                        >
                            <input
                                type="radio"
                                name="uuidVersion"
                                value="v7"
                                class="radio radio-primary radio-sm"
                            />
                            <span class="label-text">v7 (Unix Epoch)</span>
                        </label>
                        <label
                            class="label cursor-pointer gap-2 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors"
                        >
                            <input
                                type="radio"
                                name="uuidVersion"
                                value="v5"
                                class="radio radio-primary radio-sm"
                            />
                            <span class="label-text">v5 (Name-based)</span>
                        </label>
                    </div>
                </div>

                <!-- Global Options -->
                <div class="form-control">
                    <label
                        class="label cursor-pointer justify-start gap-4 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors w-fit"
                    >
                        <span class="label-text">Include Hyphens</span>
                        <input
                            type="checkbox"
                            id="globalHyphens"
                            class="toggle toggle-primary toggle-sm"
                            checked
                        />
                    </label>
                </div>
            </div>

            <!-- v5 Name Input (Conditional) -->
            <div
                id="v5InputContainer"
                class="hidden mt-4 pt-4 border-t border-base-200"
            >
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control w-full">
                        <div class="label">
                            <span class="label-text font-bold"
                                >Name (Required for v5)</span
                            >
                        </div>
                        <input
                            type="text"
                            id="v5Name"
                            placeholder="Enter a name"
                            class="input input-bordered w-full"
                            value="https://randgen.space/"
                        />
                        <div class="label">
                            <span class="label-text-alt"
                                >Name can be anything. The same namespace with
                                the same name will always produce the same UUID.</span
                            >
                        </div>
                    </div>

                    <div class="form-control">
                        <div class="label">
                            <span class="label-text font-bold">Namespace</span>
                        </div>
                        <div class="flex gap-4">
                            <label
                                class="label cursor-pointer gap-2 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors"
                            >
                                <input
                                    type="radio"
                                    name="v5Namespace"
                                    value="url"
                                    class="radio radio-primary radio-sm"
                                    checked
                                />
                                <span class="label-text">URL</span>
                            </label>
                            <label
                                class="label cursor-pointer gap-2 border border-base-300 rounded-lg px-3 py-2 hover:bg-base-200 transition-colors"
                            >
                                <input
                                    type="radio"
                                    name="v5Namespace"
                                    value="dns"
                                    class="radio radio-primary radio-sm"
                                />
                                <span class="label-text">DNS</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Single UUID Generator Card -->
    <div class="card bg-base-100 shadow-xl mb-8 border border-base-300">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-6">Single UUID</h2>

            <div
                class="flex flex-col md:flex-row gap-4 items-center justify-between p-6 bg-base-200 rounded-box mb-6"
            >
                <code
                    id="singleUuid"
                    class="text-xl md:text-2xl font-mono break-all text-primary font-bold"
                >
                    Click generate to start
                </code>
                <div class="flex gap-2 shrink-0">
                    <button
                        id="copySingleBtn"
                        class="btn btn-square btn-ghost"
                        aria-label="Copy UUID"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                            ></path>
                        </svg>
                    </button>
                    <button
                        id="regenerateBtn"
                        class="btn btn-square btn-ghost"
                        aria-label="Regenerate UUID"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                            ></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div
                class="flex flex-col sm:flex-row justify-end items-center gap-4"
            >
                <button
                    id="generateBtn"
                    class="btn btn-primary w-full sm:w-auto min-w-[200px]"
                >
                    Generate UUID
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk UUID Generator Card -->
    <div class="card bg-base-100 shadow-xl border border-base-300">
        <div class="card-body">
            <div class="flex justify-between items-center mb-6">
                <h2 class="card-title text-2xl">Bulk Generation</h2>
                <span class="badge badge-secondary">Batch Mode</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 mb-6 gap-4">
                <div class="form-control">
                    <input
                        type="number"
                        id="bulkCount"
                        class="input input-bordered"
                        value="10"
                        min="1"
                        max="100"
                    />
                    <label class="label" for="bulkCount">
                        <span class="label-text">Quantity (1-100)</span>
                    </label>
                </div>
                <div class="form-control justify-end">
                    <button
                        id="generateBulkBtn"
                        class="btn btn-primary w-full min-w-[200px]"
                    >
                        Generate Batch
                    </button>
                </div>
            </div>

            <div class="relative">
                <div
                    id="bulkOutput"
                    class="textarea textarea-bordered h-64 w-full font-mono text-sm leading-relaxed overflow-y-auto bg-base-200 p-4 rounded-box empty:before:content-['Generated_UUIDs_will_appear_here...'] empty:before:text-base-content/50 empty:before:italic"
                >
                </div>
                <div class="absolute top-2 right-2 flex gap-2">
                    <button
                        id="copyBulkBtn"
                        class="btn btn-xs btn-ghost tooltip tooltip-left"
                        data-tip="Copy All"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                            ></path>
                        </svg>
                    </button>
                    <button
                        id="downloadBulkBtn"
                        class="btn btn-xs btn-ghost tooltip tooltip-left"
                        data-tip="Download .txt"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                            ></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div
                class="text-xs text-base-content/50 mt-2 text-right"
                id="uuidCounter"
            >
            </div>
        </div>
    </div>

    <!-- SEO Content -->
    <div class="card bg-base-100 shadow-xl border border-base-300 mt-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
                About UUID Generator (RFC 9562)
            </h2>
            <div class="prose max-w-none">
                <p>
                    If you need a globally unique identifier for databases,
                    APIs, events, or distributed systems,
                    <strong>UUIDs</strong> are still the default choice. A UUID is
                    a <strong>128-bit value (16 octets)</strong>
                    with standardized text representations and well-defined versioning
                    rules. The current IETF/RFC Editor standard describing UUID formats
                    and versions is <strong>RFC 9562</strong>.
                </p>

                <h3 class="text-lg font-bold mt-4 mb-2">
                    Which UUID version should you use?
                </h3>
                <ul class="list-disc pl-5 mb-4">
                    <li>
                        <strong>UUID v4 (random)</strong>: Great for general
                        uniqueness when you don’t care about chronological
                        ordering.
                    </li>
                    <li>
                        <strong>UUID v7 (time-ordered)</strong>: Ideal when you
                        want UUIDs that <em>generally sort by creation time</em> (helpful
                        for database indexes, event streams, and logs). RFC 9562 defines
                        v7 as a Unix timestamp in milliseconds plus randomness.
                    </li>
                    <li>
                        <strong>UUID v5 (name-based, deterministic)</strong>:
                        Useful when the same input should always produce the
                        same UUID (idempotency, stable IDs from names/slugs),
                        via a namespace + name.
                    </li>
                </ul>

                <h3 class="text-lg font-bold mt-6 mb-2">
                    JavaScript / TypeScript examples
                </h3>
                <p class="mb-2">
                    Using the popular <code>uuid</code> NPM package:
                </p>
                <Code
                    code={`import { v4 as uuidv4, v5 as uuidv5, v7 as uuidv7 } from "uuid";

// v4: random UUID
const idV4: string = uuidv4();

// v7: time-ordered UUID
const idV7: string = uuidv7();

// v5: deterministic UUID from (name + namespace)
const DNS_NAMESPACE = uuidv5.DNS;
const userSlug = "ben@example.com";
const stableId: string = uuidv5(userSlug, DNS_NAMESPACE);

console.log({ idV4, idV7, stableId });`}
                    lang="ts"
                    theme="dark-plus"
                />

                <p class="mb-2">
                    <strong>Browser-native option (Web Crypto):</strong>
                </p>
                <Code
                    code={`const id = crypto.randomUUID();`}
                    lang="ts"
                    theme="dark-plus"
                />

                <h3 class="text-lg font-bold mt-4 mb-2">
                    Practical tips developers care about
                </h3>
                <ul class="list-disc pl-5 mb-4">
                    <li>
                        <strong>Need sortable IDs?</strong> Prefer <strong
                            >UUID v7</strong
                        > over v4 for better locality (newer values tend to cluster),
                        which can reduce index fragmentation in many databases.
                    </li>
                    <li>
                        <strong>Need stable IDs from names?</strong> Use <strong
                            >v5</strong
                        > so the same (namespace + name) always maps to the same UUID.
                    </li>
                    <li>
                        <strong>Security note:</strong> UUIDs are identifiers, not
                        secrets. Don’t treat them like access tokens. If exposing
                        UUIDs publicly, enforce authorization checks on the server.
                    </li>
                </ul>

                <hr class="my-6 border-base-200" />

                <p class="text-sm text-base-content/70">
                    Looking for a reliable <strong
                        >random number generator</strong
                    > or <strong>UUID generator</strong>? Our tool creates
                    standard <strong>UUIDs</strong>, functioning as a robust <strong
                        >random generator</strong
                    >
                    and <strong>random object generator</strong> for your applications.
                    It provides a structured alternative to a basic
                    <strong>google random number generator</strong> or generic <strong
                        >random nr</strong
                    > tools when you need statistically unique identifiers.
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div
        id="toast"
        class="toast toast-bottom toast-center transition-opacity duration-300 opacity-0 pointer-events-none"
    >
        <div class="alert alert-info">
            <span id="toastMessage">Message sent successfully.</span>
        </div>
    </div>
</div>

<script>
    import { v4, v5, v6, v7 } from "uuid";

    // Constants
    const NAMESPACE_URL = "6ba7b810-9dad-11d1-80b4-00c04fd430c8";

    // DOM Elements
    const singleUuidEl = document.getElementById("singleUuid");
    const generateBtn = document.getElementById("generateBtn");
    const regenerateBtn = document.getElementById("regenerateBtn");
    const copySingleBtn = document.getElementById("copySingleBtn");

    // Global Config Elements
    const globalHyphensCheckbox = document.getElementById(
        "globalHyphens",
    ) as HTMLInputElement;
    const versionInputs = document.querySelectorAll(
        'input[name="uuidVersion"]',
    );
    const v5InputContainer = document.getElementById("v5InputContainer");
    const v5NameInput = document.getElementById("v5Name") as HTMLInputElement;
    const v5NamespaceInputs = document.querySelectorAll(
        'input[name="v5Namespace"]',
    );

    // Bulk Elements
    const bulkCountInput = document.getElementById(
        "bulkCount",
    ) as HTMLInputElement;
    const generateBulkBtn = document.getElementById(
        "generateBulkBtn",
    ) as HTMLButtonElement;
    const bulkOutput = document.getElementById("bulkOutput");
    const copyBulkBtn = document.getElementById("copyBulkBtn");
    const downloadBulkBtn = document.getElementById("downloadBulkBtn");
    const uuidCounter = document.getElementById("uuidCounter");

    let bulkUuids: string[] = [];

    // Helper: Get current config
    function getConfig() {
        const selectedVersion =
            (
                document.querySelector(
                    'input[name="uuidVersion"]:checked',
                ) as HTMLInputElement
            )?.value || "v4";
        const selectedNamespace =
            (
                document.querySelector(
                    'input[name="v5Namespace"]:checked',
                ) as HTMLInputElement
            )?.value || "url";
        const includeHyphens = globalHyphensCheckbox?.checked ?? true;
        const v5Name = v5NameInput?.value || "https://randgen.space/";
        return {
            version: selectedVersion,
            includeHyphens,
            v5Name,
            namespace: selectedNamespace,
        };
    }

    // Logic: Version Visibility
    function updateVersionUI() {
        const { version } = getConfig();
        if (version === "v5") {
            v5InputContainer?.classList.remove("hidden");
            // Disable bulk for v5
            if (generateBulkBtn) generateBulkBtn.disabled = true;
            if (bulkCountInput) bulkCountInput.disabled = true;
            if (generateBulkBtn) generateBulkBtn.textContent = "N/A for v5";
        } else {
            v5InputContainer?.classList.add("hidden");
            // Enable bulk
            if (generateBulkBtn) generateBulkBtn.disabled = false;
            if (bulkCountInput) bulkCountInput.disabled = false;
            if (generateBulkBtn) generateBulkBtn.textContent = "Generate Batch";
        }
        updateSingleUUID(); // Auto-update single UUID
    }

    // Event Listeners for Config
    versionInputs.forEach((input) => {
        input.addEventListener("change", updateVersionUI);
    });
    // Type assertion for namespace inputs to fix TS error
    v5NamespaceInputs.forEach((input) => {
        input.addEventListener("change", updateSingleUUID);
    });
    globalHyphensCheckbox?.addEventListener("change", updateSingleUUID);
    v5NameInput?.addEventListener("input", updateSingleUUID); // Update v5 as you type

    // Generator Core
    function createUUID(
        version: any,
        name: string | Uint8Array<ArrayBufferLike>,
        namespaceType: string = "url",
    ) {
        try {
            switch (version) {
                case "v4":
                    return v4();
                case "v5":
                    const namespace = namespaceType === "dns" ? v5.DNS : v5.URL;
                    return v5(name, namespace);
                case "v6":
                    return v6();
                case "v7":
                    return v7();
                default:
                    return v4();
            }
        } catch (e) {
            console.error("UUID Generation Error:", e);
            return "Error";
        }
    }

    function generateFormattedUUID() {
        const { version, includeHyphens, v5Name, namespace } = getConfig();
        const rawUuid = createUUID(version, v5Name, namespace);
        return includeHyphens ? rawUuid : rawUuid.replace(/-/g, "");
    }

    // Single UUID Logic
    function updateSingleUUID() {
        if (!singleUuidEl) return;

        // Add a small animation effect
        singleUuidEl.classList.add("opacity-50");

        // Small delay to allow UI to feel responsive
        setTimeout(() => {
            singleUuidEl.textContent = generateFormattedUUID();
            singleUuidEl.classList.remove("opacity-50");
        }, 50);
    }

    generateBtn?.addEventListener("click", updateSingleUUID);
    regenerateBtn?.addEventListener("click", updateSingleUUID);

    copySingleBtn?.addEventListener("click", () => {
        const text = singleUuidEl?.textContent?.trim();
        if (text && text !== "Click generate to start") {
            copyToClipboard(text);
            showToast("UUID copied to clipboard!");
        } else {
            updateSingleUUID();
            setTimeout(() => {
                const newText = singleUuidEl?.textContent?.trim();
                if (newText) {
                    copyToClipboard(newText);
                    showToast("Generated & Copied!");
                }
            }, 100);
        }
    });

    // Bulk UUID Logic
    function generateBulk() {
        if (!bulkCountInput || !bulkOutput || !uuidCounter) return;

        let count = Math.min(
            Math.max(parseInt(bulkCountInput.value) || 10, 1),
            100,
        );
        bulkCountInput.value = count.toString();

        bulkUuids = [];
        for (let i = 0; i < count; i++) {
            bulkUuids.push(generateFormattedUUID());
        }

        bulkOutput.innerHTML = bulkUuids.join("<br>");
        uuidCounter.textContent = `Generated ${bulkUuids.length} UUID${bulkUuids.length > 1 ? "s" : ""}`;
    }

    generateBulkBtn?.addEventListener("click", generateBulk);

    copyBulkBtn?.addEventListener("click", () => {
        if (bulkUuids.length > 0) {
            copyToClipboard(bulkUuids.join("\n"));
            showToast(`${bulkUuids.length} UUIDs copied to clipboard!`);
        } else {
            showToast("Generate UUIDs first!");
        }
    });

    downloadBulkBtn?.addEventListener("click", () => {
        if (bulkUuids.length > 0) {
            const blob = new Blob([bulkUuids.join("\n")], {
                type: "text/plain",
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `uuids-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast("UUIDs downloaded!");
        } else {
            showToast("Generate UUIDs first!");
        }
    });

    // Utilities
    function copyToClipboard(text: string) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text);
        } else {
            // Fallback
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            textarea.style.opacity = "0";
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
        }
    }

    function showToast(message: string | null) {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");
        if (toast && toastMessage) {
            toastMessage.textContent = message;
            toast.classList.remove("opacity-0");
            setTimeout(() => toast.classList.add("opacity-0"), 2500);
        }
    }

    // Validation for bulk input
    bulkCountInput?.addEventListener("input", function () {
        let value = parseInt(this.value);
        if (value > 100) this.value = "100";
        if (value < 1 && this.value !== "") this.value = "1";
    });

    // Initial load
    updateSingleUUID();
</script>
